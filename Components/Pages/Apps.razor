@page "/apps"
@using AppInfo = BookHeaven.Reader.Entities.AppInfo
@inject IAppsService AppsService

<SectionContent SectionName="Header">
    <RadioButtonGroup Class="m-3" TOption="@SortBy" @bind-SelectedOption="_sortBy" @bind-SelectedOption:after="Sort" />
</SectionContent>

@if (_apps.Count > 0)
{
    <ContextMenu Id="AppMenu" Context="appContext" Animation="Animation.Grow" OverrideDefaultCssClass="absolute border bg-white">
        @{
            var app = (AppInfo)appContext.Data;
        }
        <Item OverrideDefaultCssClass="p-2">@app.Name</Item>
        <Item OnClick="@(() => AppsService.OpenApp(app.PackageName!))"><i class="bi bi-box-arrow-up-right me-5"></i>@Translations.OPEN</Item>
        <Item OnClick="@(() => AppsService.OpenInfo(app.PackageName!))"><i class="bi bi-info-circle me-5"></i>@Translations.INFO</Item>
        @if (AppsService.CanBeUninstalled(app.PackageName!))
        {
            <Item OnClick="@(() => AppsService.UninstallApp(app.PackageName!))"><i class="bi bi-trash me-5"></i>@Translations.UNINSTALL</Item>
        }
    </ContextMenu>

    <div class="grid grid-cols-6 auto-rows-fr gap-4 p-4 pt-1">
        @foreach (var app in _filteredApps)
        {
            <ContextMenuTrigger MenuId="AppMenu" Data="@app">
                <div class="grid p-1 gap-0.5 h-full rounded active:bg-neutral-200 active:outline-4 active:outline-neutral-200" @onclick="@(() => AppsService.OpenApp(app.PackageName!))">
                    <img src="data:image/png;base64,@app.IconBase64" class="mx-auto w-16" alt="App icon"/>
                    <span class="text-sm line-clamp-2 text-center p-1">@app.Name</span>
                </div>
            </ContextMenuTrigger>
        }
    </div>
}