@page "/books"
@using BookHeaven.Domain.Enums
@using BookHeaven.Reader.Components.Pages.Books.Components
@layout BooksLayout

@if (BookManager.Books.Count == 0)
{
    <Message Content="@Translations.NO_BOOKS_FOUND"/>
    return;
}

<BookInfo @bind-Book="_selectedBook"></BookInfo>

<ContextMenu Id="BookMenu" Context="context" Animation="Animation.Grow" OverrideDefaultCssClass="absolute border bg-white">
    @{
        var book = (Book)context.Data;
    }
    <Item OnClick="@(() => _selectedBook = book)"><i class="bi bi-info-circle me-5"></i>@Translations.INFO</Item>
</ContextMenu>

<RadioButtonGroup Class="mx-3 mt-3" TOption="@Filter" @bind-SelectedOption="_selectedFilter" />

<div class="grid-cols-[repeat(auto-fill,120px)] grid justify-evenly gap-2 p-3">
    @if (FilteredBooks.Count == 0)
    {
        <Message Content="@Translations.BOOKS_NO_FILTER_MATCH"/>
    }
    else
    {
        @foreach (var book in FilteredBooks)
        {
            <ContextMenuTrigger MenuId="BookMenu" Data="@book">
                <a class="flex flex-col" href="/reader/@book.BookId">
                    <div class="cover relative h-[190px] w-full">
                        <img class="h-full w-full" src="@book.GetCoverAsBase64(MauiProgram.CoversPath)" alt=""/>
                        <span class="progress-badge absolute -top-[1px] right-0 w-[40%] font-bold">
                            <img src="/progress-badge.svg" class="w-full align-top" alt=""/>
                            @if (book.ReadingStatus() != BookStatus.New)
                            {
                                <span>@book.Progress()!.Progress.ToString("0.##")%</span>
                            }
                            else
                            {
                                <span>@Translations.NEW</span>
                            }
                        </span>
                    </div>
                    <div class="text-xs">@book.Title</div>
                </a>
            </ContextMenuTrigger>
        }
    }
</div>